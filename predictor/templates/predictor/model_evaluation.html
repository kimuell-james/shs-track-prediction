{% extends 'predictor/main.html' %}

{% block content %}

<h1>ðŸ“ˆ Model Evaluation</h1>
<hr>

{% if no_data %}
<h3>No data available for evaluation.</h3>
{% else %}
<h3>Model Evaluation for School Year {{ current_sy }}</h3>
<div class="stats">
    <h5><b>Total records evaluated:</b> {{ count }}</h5>
    <h5><b>Accuracy:</b> {{ accuracy }}%</h5>
</div>
<div class="mt-3">
    <p><strong>Overall Performance:</strong> {{ analysis.overall|safe }}</p>
    <p><strong>Recommendation:</strong> {{ analysis.recommendation|safe }}</p>
</div>
<hr>

<h3>Classification Metrics</h3>
<!-- Table -->
<table class="table table-striped table-hover text-center">
    <tr>
        <th>Label</th>
        <th>Precision</th>
        <th>Recall</th>
        <th>F1-Score</th>
        <th>Support</th>
    </tr>
    {% for label, metrics in report.items %}
    {% if label not in "accuracy macro avg weighted avg" %}
    <tr>
        <td>{{ label }}</td>
        <td>{{ metrics.precision|floatformat:2 }}</td>
        <td>{{ metrics.recall|floatformat:2 }}</td>
        <td>{{ metrics.f1_score|floatformat:2 }}</td>
        <td>{{ metrics.support }}</td>
    </tr>
    {% endif %}
    {% endfor %}
</table>
<div class="mt-3">
    <p><strong>Class-wise Insights:</strong> {{ analysis.classwise|safe }}</p>
</div>
<hr>

<h3>Confusion Matrix</h3>
<div class="text-center">
    <img src="data:image/png;base64,{{ cm_base64 }}" class="img-fluid" alt="Confusion Matrix" />
</div>
<div class="mt-3">
    <p><strong>Confusion Matrix Interpretation:</strong> {{ analysis.confusion|safe }}</p>
</div>
<hr>

<h3>ROC Curve</h3>
<div class="text-center">
    <h5>ROC-AUC Score: <strong>{{ roc_auc }}</strong></h5>
    <img src="data:image/png;base64,{{ roc_base64 }}" class="img-fluid" alt="ROC Curve" />
</div>
<div class="mt-3">
    <p><strong>ROC-AUC Score Analysis:</strong> {{ analysis.roc_auc|safe }}</p>
</div>

{% endif %}
{% endblock %}